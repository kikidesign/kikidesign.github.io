<!doctype html>
<html class="no-js" lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>上传文档到知识库</title>		
		<meta name="description" content="Hurst – Furniture Store eCommerce HTML Template is a clean and elegant design – suitable for selling flower, cookery, accessories, fashion, high fashion, accessories, digital, kids, watches, jewelries, shoes, kids, furniture, sports….. It has a fully responsive width adjusts automatically to any screen size or resolution.">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
		<!-- Place favicon.ico in the root directory -->
		
		<!-- Google Font -->
		<link href='https://fonts.googleapis.com/css?family=Lato:400,700,900' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>

		<!-- all css here -->
		<!-- bootstrap v3.3.6 css -->
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<!-- animate css -->
		<link rel="stylesheet" href="css/animate.min.css">
		<!-- jquery-ui.min css -->
		<link rel="stylesheet" href="css/jquery-ui.min.css">
		<!-- meanmenu css -->
		<link rel="stylesheet" href="css/meanmenu.min.css">
		<!-- nivo-slider css -->
		<link rel="stylesheet" href="lib/css/nivo-slider.css">
		<link rel="stylesheet" href="lib/css/preview.css">
		<!-- slick css -->
		<link rel="stylesheet" href="css/slick.min.css">
		<!-- lightbox css -->
		<link rel="stylesheet" href="css/lightbox.min.css">
		<!-- material-design-iconic-font css -->
		<link rel="stylesheet" href="css/material-design-iconic-font.css">
		<!-- All common css of theme -->
		<link rel="stylesheet" href="css/default.css">
		<!-- style css -->
		<link rel="stylesheet" href="style.min.css">
        <!-- shortcode css -->
        <link rel="stylesheet" href="css/shortcode.css">
		<!-- responsive css -->
		<link rel="stylesheet" href="css/responsive.css">
		<!-- modernizr css -->
		<script src="js/vendor/modernizr-3.11.2.min.js"></script>
	</head>
	<body>	
		<!-- WRAPPER START -->
		<div class="wrapper bg-dark-white">
			<!-- Navigation START -->
			<div class="area-404 pt-40 pb-40">
				<div class="container">	
					<div class="row">
						<div class="col-lg-12">
							<ul >
								<li>
									<p> • 长文本内容（TXT、Markdown、DOCX、HTML、JSON、PDF）</p>
								</li>
								<li>
									<p> • 结构化数据（CSV、Excel 等）</p>
								</li>
								<li>
									<p> • 单文档的上传大小限制为 15MB </p>
								</li>
							</ul>
						</div>						
					</div>
					<div class="row mt20">
						<div class="col-lg-12">
							<div>
                                <input type="file" id="fileInput">
                            </div>
						</div>						
					</div>
				</div>
			</div>
			<!-- Navigation END -->		
			<!-- QUICKVIEW PRODUCT -->
			<div id="quickview-wrapper">
			   <!-- Modal -->
			   <div class="modal fade" id="productModal" tabindex="-1" role="dialog">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							</div>
							<div class="modal-body">
								<div class="modal-product">
									<div class="product-images">
										<div class="main-image images">
											<img alt="#" src="img/product/quickview-photo.jpg"/>
										</div>
									</div><!-- .product-images -->
								</div><!-- .modal-product -->
							</div><!-- .modal-body -->
						</div><!-- .modal-content -->
					</div><!-- .modal-dialog -->
			   </div>
			   <!-- END Modal -->
			</div>
			<!-- END QUICKVIEW PRODUCT -->	
		</div>
		<!-- WRAPPER END -->
		<!-- all js here -->
		<!-- jquery latest version -->
		<script>
			var fileInput = document.getElementById('fileInput');
			var url = 'https://api.dify.ai/v1/datasets/34892664-db8e-4a56-9aad-40ad991f34fa/document/create-by-file'
			fileInput.addEventListener('change', function () {
				var file = fileInput.files[0];
				// var fileUrl = URL.createObjectURL(file);
				// var filePath = fileInput.value; // 获得上传文件的绝对路径 
			 	var fileSize = file.size/1024/1024;
			 	// 创建一个FormData对象
			    var formData = new FormData();
			 	alert(fileSize)
		        if (fileSize > 15) {
		            alert("上传附件不能大于15M");
		        }else{
				    // formData.append('file', file);
				 //    const xhr = new XMLHttpRequest();
				 //    xhr.open('POST', url, true);
				 //    xhr.setRequestHeader('Authorization','Bearer dataset-mPM7JLZyhVLxGXEUypxSIK6q');
				 //    xhr.setRequestHeader('Content-Type','multipart/form-data');
					// // xhr.setRequestHeader('Content-Type','application/json');
					// alert("正在上传请稍后...");
				 //    xhr.upload.addEventListener('progress', function(event) {
				 //        if (event.lengthComputable) {
				 //            const percentComplete = (event.loaded / event.total) * 100;
				 //            console.log(`Upload progress: ${percentComplete}%`);
				 //        }
				 //    });
				 //    xhr.onload = function() {
				 //        if (xhr.status === 200) {
				 //            console.log('Upload successful:', xhr.responseText);
				 //            alert("上传成功！");
				 //        } else {
				 //            alert("上传失败...原因："+xhr.responseText);
				 //        }
				 //    };
				 //    xhr.send(formData);
					// --form 'file=@C:/Users/LEO/Desktop/1.txt'
			        const indexingData = {
			            //索引方式
			            indexing_technique: 'high_quality',
			            //处理规则
			            process_rule: {
			                rules: {
			                    pre_processing_rules: [
			                        {id: 'remove_extra_spaces', enabled: true},
			                        {id: 'remove_urls_emails', enabled: true}
			                    ],
			                    segmentation: {
			                        separator: '###',
			                        max_tokens: 500
			                    }
			                },
			                mode: 'custom'
			            }
			        };
			        formData.append('data', indexingData); 
			        // formData.append('type', 'text/plain');
			        //'@C:/Users/LEO/Desktop/1.txt'
			        formData.append('file',file, '1.txt'); 
			        alert(formData)
					// 发送POST请求
	                fetch(url, {
	                    method: 'POST',
	                    headers: {
	                        'Authorization': 'Bearer dataset-mPM7JLZyhVLxGXEUypxSIK6q'
	                    },
	                    body: formData
	                }).then(response => {
	                	console.log(response.responseText)
	                	alert(response.responseText)
	                }).then(data => {
	                	console.log(data)
	                }).catch(error => {
	                    alert("上传出错")
	                }); 
		        }
			});
		</script>
		<script src="js/vendor/jquery-3.6.0.min.js"></script>
		<script src="js/vendor/jquery-migrate-3.3.2.min.js"></script>
		<!-- bootstrap js -->
		<script src="js/bootstrap.bundle.min.js"></script>
		<!-- jquery.meanmenu js -->
		<script src="js/jquery.meanmenu.js"></script>
		<!-- slick.min js -->
		<script src="js/slick.min.js"></script>
		<!-- jquery.treeview js -->
		<script src="js/jquery.treeview.js"></script>
		<!-- lightbox.min js -->
		<script src="js/lightbox.min.js"></script>
		<!-- jquery-ui js -->
		<script src="js/jquery-ui.min.js"></script>
		<!-- jquery.nivo.slider js -->
		<script src="lib/js/jquery.nivo.slider.js"></script>
		<script src="lib/home.js"></script>
		<!-- jquery.nicescroll.min js -->
		<script src="js/jquery.nicescroll.min.js"></script>
		<!-- countdon.min js -->
		<script src="js/countdon.min.js"></script>
		<!-- wow js -->
		<script src="js/wow.min.js"></script>
		<!-- plugins js -->
		<script src="js/plugins.js"></script>
		<!-- main js -->
		<script src="js/main.min.js"></script>
	</body>
</html>
